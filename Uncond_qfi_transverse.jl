ρDiag(m,NN,t,κ) =
    0.5.*(2.0^(-NN).*(1+-exp.(-κ.*t)).^(-m+NN).*(1.0+exp.(-κ.*t)).^m+2.0^(-NN).*(1-exp.(-κ.*t)).^m.*(1+exp.(-κ.*t)).^(-m+NN))
ρAntiDiag(m,NN,t,κ,om) = (0.5).*((exp.((-0.5).*κ.*t).*κ.*(κ.^2-4.0.*om.^2).^(-0.5).*sinh.((0.5).*(κ.^2-4.0.*om.^2).^(0.5).*t)).^m.*(exp.((-0.5).*κ.*t).*(cosh.((0.5).*(κ.^2-4.0.*om.^2).^(0.5).*t)+(1im*(-2)).*om.*(κ.^2-4.0.*om.^2).^(-0.5).*sinh.((0.5).*(κ.^2-4.0.*om.^2).^(0.5).*t))).^(-m+NN)+(exp.((-0.5).*κ.*t).*κ.*(κ.^2+(-4).*om.^2).^(-0.5).*sinh.((0.5).*(κ.^2-4.0.*om.^2).^(0.5).*t)).^(-m+NN).*(exp.((-0.5).*κ.*t).*(cosh.((0.5).*(κ.^2-4.0.*om.^2).^(0.5).*t)+(1im*2).*om.*(κ.^2-4.0.*om.^2).^(-0.5).*sinh.((0.5).*(κ.^2-4.0.*om.^2).^(0.5).*t))).^m)
dρAntiDiag(m,NN,t,κ,om)=-(κ.^(2.0)+(-4).*om.^(2.0)).^(-1.5).*(exp.((-0.5).*κ.*m.*t).*m.*om.*(κ.^(2.0)+(-4).*om.^(2.0)).^((0.5)+(-0.5).*m).*((-2)+(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t.*coth.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)).*(κ.*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)).^m.*(exp.((-0.5).*κ.*t).*(cosh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)+(1im*(-2)).*om.*(κ.^(2.0)+(-4).*om.^(2.0)).^(-0.5).*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t))).^((-1).*m+NN)+(-1).*(m+(-1).*NN).*om.*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*((-2)+(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t.*coth.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)).*(exp.((-0.5).*κ.*t).*κ.*(κ.^(2.0)+(-4).*om.^(2.0)).^(-0.5).*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)).^((-1).*m+NN).*(exp.((-0.5).*κ.*t).*(cosh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)+(1im*2).*om.*(κ.^(2.0)+(-4).*om.^(2.0)).^(-0.5).*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t))).^m+1im.*exp.((-0.5).*κ.*t).*m.*(exp.((-0.5).*κ.*t).*κ.*(κ.^(2.0)+(-4).*om.^(2.0)).^(-0.5).*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)).^((-1).*m+NN).*(exp.((-0.5).*κ.*t).*(cosh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)+(1im*2).*om.*(κ.^(2.0)+(-4).*om.^(2.0)).^(-0.5).*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t))).^((-1)+m).*(2.*om.^(2.0).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t.*cosh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)+((1im*4).*om.^3.*t+κ.^(2.0).*((-1)+(1im*(-1)).*om.*t)).*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t))+1im.*exp.((-0.5).*κ.*t).*(m+(-1).*NN).*(exp.((-0.5).*κ.*t).*κ.*(κ.^(2.0)+(-4).*om.^(2.0)).^(-0.5).*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)).^m.*(exp.((-0.5).*κ.*t).*(cosh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)+(1im*(-2)).*om.*(κ.^(2.0)+(-4).*om.^(2.0)).^(-0.5).*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t))).^((-1)+(-1).*m+NN).*(2.*om.^(2.0).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t.*cosh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)+1im.*((-4).*om.^3.*t+κ.^(2.0).*(1im+om.*t)).*sinh.((0.5).*(κ.^(2.0)+(-4).*om.^(2.0)).^(0.5).*t)))

function QFIqubit(ρ11,ρ12,dρ12)
    reC=real(ρ12./ρ11)
    imC=imag(ρ12./ρ11)
    redC=real(dρ12./ρ11)
    imdC=imag(dρ12./ρ11)
    return 2*ρ11.*(redC.^2 + imdC.^2 + ( (reC.*redC + imC.*imdC).^2)./(1 - reC.^2 - imC.^2))
end

function Uncond_qfi_transverse(t, NN, κ, om) 
    tot=0.
    for m=0:NN
        r11= ρDiag(m,NN,t,κ)
        r12=ρAntiDiag(m,NN,t,κ, Complex(om))
        dr12=dρAntiDiag(m,NN,t,κ, Complex(om))
        tot+= binomial(NN,m)*QFIqubit(r11,r12,dr12)
    end
    return 0.5*real(tot)
end